## 什么是关联查询
关联查询（Join Query）在SQL中是指将两个或多个表中的数据行根据某些共同的列进行组合，以形成一个新的结果集。
这种查询允许你从多个表中检索信息，而这些表通常通过某种逻辑关系相连，比如主键-外键关系。关联查询是关系型数据库管理系统（RDBMS）中用于处理和分析跨多表数据的核心功能之一。
* 基于条件组合数据： 关联查询使用一个或多个条件来决定哪些行应该被组合在一起。这个条件通常是两个表中某一列值相等，但这并不限于等于操作，也可以是其他类型的比较或逻辑表达式。
* 创建临时结果集： 当执行关联查询时，数据库会创建一个临时的结果集，它包含了来自参与关联的所有表的相关数据。这个结果集可以进一步被过滤、排序或分组。
* 多种连接类型： SQL支持不同的JOIN类型，如INNER JOIN, LEFT JOIN, RIGHT JOIN, FULL JOIN等，每种类型决定了当没有匹配的行时如何处理结果集。例如，INNER JOIN只会返回有匹配的数据行，而LEFT JOIN会保留左表的所有行，即使右表中没有匹配项。
* 提高数据检索效率： 通过正确地使用索引和优化JOIN条件，关联查询可以帮助提高数据检索的速度和效率。这是因为在实际应用中，数据往往分散存储在多个表中，有效地关联这些表能够减少数据冗余并提高查询性能。
* 遵循关系模型原则： 关联查询的设计和实现紧密遵循关系数据库理论中的规范化原则，确保数据的一致性和完整性。同时，它也体现了关系型数据库的一个重要特性：能够在保持数据独立性的同时，灵活地访问和操作数据。

直接实操，演示用的数据库和表：

数据库名称为： project_test

**表 course**：
```bash
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int(11)      | NO   | PRI | NULL    | auto_increment |
| title     | varchar(255) | YES  |     | NULL    |                |
| outline   | varchar(255) | YES  |     | NULL    |                |
| hour      | varchar(10)  | NO   |     | 0       |                |
| classroom | varchar(255) | YES  |     | NULL    |                |
| remark    | varchar(255) | YES  |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
```
数据
```bash
+----+--------------------+--------------------------+------+--------------------------------+-----------------+
| id | title              | outline                  | hour | classroom                      | remark          |
+----+--------------------+--------------------------+------+--------------------------------+-----------------+
|  1 | 高数               | 简介12332                | 100  | 阶梯教室201                     | 备注            |
|  2 | c语言              | c语言设计                 | 70   | 大课堂8811                     | 自带机器        |
|  3 | 程控交换技术        | 程控交换技术简介           | 100  | 通讯工程学院实验室203            | 不会的别来      |
|  4 | c语言进阶          | c语言程序进阶              | 50   | 大课堂8811                     | 备注            |
|  5 | 光通信             | 阿巴阿巴                  | 80   | 通讯工程学院实验室206            | 阿巴            |
|  6 | 水课               | 来划水                   | 20   | 宿舍                            | 水课啊          |
+----+--------------------+--------------------------+------+--------------------------------+-----------------+
```

**teacher**
```bash
+------------+--------------+------+-----+---------+----------------+
| Field      | Type         | Null | Key | Default | Extra          |
+------------+--------------+------+-----+---------+----------------+
| id         | int(11)      | NO   | PRI | NULL    | auto_increment |
| name       | varchar(255) | YES  |     | NULL    |                |
| tel        | varchar(255) | YES  |     | NULL    |                |
| title      | varchar(255) | YES  |     | NULL    |                |
| teacher_id | int(11)      | NO   |     | NULL    |                |
+------------+--------------+------+-----+---------+----------------+
```
```bash
+----+-----------+------+-----------------------+------------+
| id | name      | tel  | title                 | teacher_id |
+----+-----------+------+-----------------------+------------+
|  1 | 张老师    | 101  | 博士生导师              |        101 |
|  2 | 李老师    | 102  | 研究生导师              |        102 |
|  3 | 白老师    | 103  | 科学院院士              |        103 |
|  4 | 华老师    | 104  | 诺贝尔奖获得者          |        104 |
+----+-----------+------+-----------------------+------------+
```

**student**
```bash
+------------+--------------+------+-----+---------+----------------+
| Field      | Type         | Null | Key | Default | Extra          |
+------------+--------------+------+-----+---------+----------------+
| id         | int(11)      | NO   | PRI | NULL    | auto_increment |
| name       | varchar(255) | NO   |     | NULL    |                |
| student_id | varchar(200) | NO   |     | NULL    |                |
| sex        | varchar(255) | NO   |     | NULL    |                |
| profession | varchar(255) | NO   |     | NULL    |                |
+------------+--------------+------+-----+---------+----------------+
```
```bash
+----+--------+------------+-----+--------------------------+
| id | name   | student_id | sex | profession               |
+----+--------+------------+-----+--------------------------+
|  1 | 张三   | s001       | 男  | 通信工程                 |
|  2 | 李四   | s002       | 男  | 通信工程                 |
|  3 | 王五   | s003       | 男  | 通信工程                 |
|  4 | 刘六   | s004       | 女  | 通信工程                 |
|  5 | 毛七   | s005       | 女  | 通信工程                 |
|  6 | 黑八   | s006       | 男  | 计算机科学与技术          |
|  7 | 黄九   | s007       | 女  | 数学                     |
|  8 | 满十   | s008       | 男  | 英语                     |
+----+--------+------------+-----+--------------------------+
```

**关联表 teacher_course：**
```bash
+------------+---------+------+-----+---------+----------------+
| Field      | Type    | Null | Key | Default | Extra          |
+------------+---------+------+-----+---------+----------------+
| id         | int(11) | NO   | PRI | NULL    | auto_increment |
| course_id  | int(11) | NO   |     | NULL    |                |
| teacher_id | int(11) | NO   |     | NULL    |                |
+------------+---------+------+-----+---------+----------------+
```
```bash
+----+-----------+------------+
| id | course_id | teacher_id |
+----+-----------+------------+
|  1 |         1 |          3 |
|  2 |         3 |          3 |
|  3 |         2 |          2 |
|  4 |         4 |          2 |
|  5 |         5 |          4 |
+----+-----------+------------+
```

**关联表 course_student：**
```bash
+-----------+---------+------+-----+---------+----------------+
| Field     | Type    | Null | Key | Default | Extra          |
+-----------+---------+------+-----+---------+----------------+
| id        | int(11) | NO   | PRI | NULL    | auto_increment |
| sudent_id | int(11) | NO   |     | NULL    |                |
| course_id | int(11) | NO   |     | NULL    |                |
+-----------+---------+------+-----+---------+----------------+
```
```bash
+----+-----------+-----------+
| id | sudent_id | course_id |
+----+-----------+-----------+
|  1 |         1 |         1 |
|  2 |         1 |         2 |
|  3 |         1 |         4 |
|  4 |         2 |         3 |
|  5 |         2 |         5 |
|  6 |         2 |         1 |
|  7 |         3 |         1 |
|  8 |         3 |         3 |
|  9 |         3 |         5 |
| 10 |         4 |         1 |
| 11 |         4 |         3 |
| 12 |         4 |         5 |
| 13 |         5 |         1 |
| 14 |         5 |         3 |
| 15 |         5 |         5 |
| 16 |         6 |         1 |
| 17 |         6 |         2 |
| 18 |         6 |         4 |
| 19 |         7 |         1 |
| 20 |         7 |         4 |
+----+-----------+-----------+
```
准备工作完成！！

## INNER JOIN (内连接)
只返回n个表中满足连接条件的匹配行(简述：关联表里有多少满足条件的关联项，就会查出多少条对应数据)，下面我们使用 `INNER JOIN` 来连接查询 老师对应的课程 和 教学所在教室：
```sql
SELECT a.name, c.title, c.classroom 
FROM teacher a 
INNER JOIN teacher_course ac 
ON a.id = ac.teacher_id
INNER JOIN course c 
ON ac.course_id = c.id
```
```bash
+-----------+--------------------+--------------------------------+
| name      | title              | classroom                      |
+-----------+--------------------+--------------------------------+
| 白老师    | 高数               | 阶梯教室201                      |
| 白老师    | 程控交换技术        | 通讯工程学院实验室203             |
| 李老师    | c语言              | 大课堂8811                       |
| 李老师    | c语言进阶           | 大课堂8811                       |
| 华老师    | 光通信             | 通讯工程学院实验室206              |
+-----------+--------------------+--------------------------------+
```
这里只显示有关联课程的老师，如果没有关联的课程（比如张老师），则不会显示。

## LEFT JOIN (左连接) 也叫左外连接（left [outer] join）
返回左表中的所有记录，即使右表中没有匹配。如果右表中没有匹配，则结果为NULL。
```sql
SELECT a.name, c.title, c.classroom 
FROM teacher a 
LEFT JOIN teacher_course ac 
ON a.id = ac.teacher_id
LEFT JOIN course c 
ON ac.course_id = c.id
```
```bash
+-----------+--------------------+--------------------------------+
| name      | title              | classroom                      |
+-----------+--------------------+--------------------------------+
| 白老师    | 高数                | 阶梯教室201                    |
| 白老师    | 程控交换技术         | 通讯工程学院实验室203           |
| 李老师    | c语言               | 大课堂8811                     |
| 李老师    | c语言进阶            | 大课堂8811                     |
| 华老师    | 光通信               | 通讯工程学院实验室206           |
| 张老师    | NULL                | NULL                          |
+-----------+--------------------+--------------------------------+
```
这里张老师没有对应的课程，所以没有对应的记录。

查询一下 某个学生的所有课程信息：
```sql
SELECT a.name, a.profession, c.title, c.classroom 
FROM student a  
LEFT JOIN course_student 
ON a.id = course_student.sudent_id
LEFT JOIN course c 
ON course_student.course_id = c.id
WHERE a.name = '张三'
```
```bash
+--------+--------------+---------------+-----------------+
| name   | profession   | title         | classroom       |
+--------+--------------+---------------+-----------------+
| 张三   | 通信工程      | 高数           | 阶梯教室201     |
| 张三   | 通信工程      | c语言          | 大课堂8811      |
| 张三   | 通信工程      | c语言进阶       | 大课堂8811      |
+--------+--------------+---------------+-----------------+
```
会查询 左表（student）中在 右表（course_student） 中有对应记录的记录，如果没有，则返回NULL。

## RIGHT JOIN (右连接) 也叫右外连接（right [outer] join）
返回右表中的所有记录，即使左表中没有匹配。如果左表中没有匹配，则结果为NULL。
```sql
SELECT a.name, c.title, c.classroom 
FROM teacher a  
RIGHT JOIN teacher_course tc
ON a.id = tc.teacher_id
RIGHT JOIN course c 
ON tc.course_id = c.id
```
```bash
+-----------+--------------------+--------------------------------+
| name      | title              | classroom                      |
+-----------+--------------------+--------------------------------+
| 白老师     | 高数               | 阶梯教室201                     |
| 李老师     | c语言              | 大课堂8811                      |
| 白老师     | 程控交换技术        | 通讯工程学院实验室203            |
| 李老师     | c语言进阶           | 大课堂8811                     |
| 华老师     | 光通信              | 通讯工程学院实验室206           |
| NULL      | 水课                | 宿舍                           |
+-----------+--------------------+--------------------------------+
```

查询某个课程有多少学生报名：
```sql
SELECT a.name, a.profession, c.title, c.classroom 
FROM student a  
RIGHT JOIN course_student cs
ON a.id = cs.sudent_id
RIGHT JOIN course c 
ON cs.course_id = c.id
WHERE c.title = '水课'
```
```bash
+------+------------+--------+-----------+
| name | profession | title  | classroom |
+------+------------+--------+-----------+
| NULL | NULL       | 水课    | 宿舍      |
+------+------------+--------+-----------+
```
这里也可以用 LEFT JOIN 来实现，效果是一样的。


## FULL JOIN (全连接) 也叫满连接（full [outer] join）
返回两个表中的所有记录，当没有匹配时，结果集中不匹配的那一侧将包含NULL （mysql 不直接支持。。。服啦）
Websites 表：
```bash
+----+--------------+---------------------------+-------+---------+
| id | name         | url                       | alexa | country |
+----+--------------+---------------------------+-------+---------+
| 1  | Google       | https://www.google.cm/    | 1     | USA     |
| 2  | 淘宝          | https://www.taobao.com/   | 13    | CN      |
| 3  | 菜鸟教程      | http://www.runoob.com/    | 4689   | CN      |
| 4  | 微博          | http://weibo.com/         | 20    | CN      |
| 5  | Facebook      | https://www.facebook.com/ | 3     | USA     |
| 7  | stackoverflow | http://stackoverflow.com/ |   0   | IND     |
+----+---------------+---------------------------+-------+---------+
```
access_log 网站访问记录表:
```bash
+-----+---------+-------+------------+
| aid | site_id | count | date       |
+-----+---------+-------+------------+
|   1 |       1 |    45 | 2016-05-10 |
|   2 |       3 |   100 | 2016-05-13 |
|   3 |       1 |   230 | 2016-05-14 |
|   4 |       2 |    10 | 2016-05-14 |
|   5 |       5 |   205 | 2016-05-14 |
|   6 |       4 |    13 | 2016-05-15 |
|   7 |       3 |   220 | 2016-05-15 |
|   8 |       5 |   545 | 2016-05-16 |
|   9 |       3 |   201 | 2016-05-17 |
+-----+---------+-------+------------+
9 rows in set (0.00 sec)
```
```sql
SELECT Websites.name, access_log.count, access_log.date
	FROM Websites

	FULL OUTER JOIN access_log
	ON Websites.id=access_log.site_id
	ORDER BY access_log.count DESC;
```
FULL OUTER JOIN 关键字返回左表（Websites）和右表（access_log）中所有的行。如果 "Websites" 表中的行在 "access_log" 中没有匹配或者 "access_log" 表中的行在 "Websites" 表中没有匹配，也会列出这些行;

mysql 不能 full outer join，所以我们另聘蹊径：
```sql
SELECT s.name, s.profession, c.title, c.classroom 
FROM student s
LEFT JOIN course_student cs ON s.id = cs.sudent_id
LEFT JOIN course c ON cs.course_id = c.id

UNION

SELECT s.name, s.profession, c.title, c.classroom 
FROM student s
RIGHT JOIN course_student cs ON s.id = cs.sudent_id
RIGHT JOIN course c ON cs.course_id = c.id
WHERE s.id IS NULL;
```
```bash
+--------+--------------------------+--------------------+--------------------------------+
| name   | profession               | title              | classroom                      |
+--------+--------------------------+--------------------+--------------------------------+
| 张三   | 通信工程                  | 高数                | 阶梯教室201                    |
| 张三   | 通信工程                  | c语言               | 大课堂8811                     |
| 张三   | 通信工程                  | c语言进阶           | 大课堂8811                     |
| 李四   | 通信工程                  | 程控交换技术         | 通讯工程学院实验室203           |
| 李四   | 通信工程                  | 光通信              | 通讯工程学院实验室206           |
| 李四   | 通信工程                  | 高数                | 阶梯教室201                    |
| 王五   | 通信工程                  | 高数                | 阶梯教室201                    |
| 王五   | 通信工程                  | 程控交换技术         | 通讯工程学院实验室203           |
| 王五   | 通信工程                  | 光通信              | 通讯工程学院实验室206           |
| 刘六   | 通信工程                  | 高数                | 阶梯教室201                    |
| 刘六   | 通信工程                  | 程控交换技术         | 通讯工程学院实验室203           |
| 刘六   | 通信工程                  | 光通信              | 通讯工程学院实验室206           |
| 毛七   | 通信工程                  | 高数                | 阶梯教室201                    |
| 毛七   | 通信工程                  | 程控交换技术         | 通讯工程学院实验室203           |
| 毛七   | 通信工程                  | 光通信              | 通讯工程学院实验室206           |
| 黑八   | 计算机科学与技术           | 高数                | 阶梯教室201                    |
| 黑八   | 计算机科学与技术           | c语言               | 大课堂8811                     |
| 黑八   | 计算机科学与技术           | c语言进阶           | 大课堂8811                     |
| 黄九   | 数学                      | 高数               | 阶梯教室201                    |
| 黄九   | 数学                      | c语言进阶           | 大课堂8811                     |
| 满十   | 英语                      | NULL               | NULL                           |
| NULL   | NULL                     | 水课                | 宿舍                           |
+--------+--------------------------+--------------------+--------------------------------+
22 rows in set (0.02 sec)
```
SQL UNION 操作符合并两个或多个 SELECT 语句的结果。

UNION 操作符用于合并两个或多个 SELECT 语句的结果集。它可以从多个表中选择数据，并将结果集组合成一个结果集。使用 UNION 时，每个 SELECT 语句必须具有相同数量的列，且对应列的数据类型必须相似。

## CROSS JOIN 交叉连接
不带ON子句的CROSS JOIN会产生笛卡尔积，即左表的每一行与右表的每一行配对。如果加上ON子句，则等同于INNER JOIN。

